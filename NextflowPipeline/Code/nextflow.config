// ===============================================================================
// CONFIGURATION PROFILE POUR BELUGA HPC CLUSTER
// ===============================================================================
// Cette configuration est spécifique au système HPC de Calcul Canada (Alliance).
// Elle définit les paramètres nécessaires pour exécuter Nextflow sur Beluga.
// ===============================================================================

params.config_profile_description = 'Alliance Beluga HPC config'  // Description du profil
params.config_profile_contact = 'https://docs.alliancecan.ca/wiki/Technical_support'  // Lien pour obtenir de l'aide technique
params.config_profile_url = 'docs.alliancecan.ca/wiki/Nextflow'  // Documentation Nextflow pour Alliance

// ===============================================================================
// CONFIGURATION GLOBALE DES PROCESSUS
// ===============================================================================
// Définit les paramètres par défaut pour tous les processus du pipeline
// ===============================================================================

process {
  executor = 'slurm' 
  clusterOptions = '--account=rrg-xroucou'
  maxRetries = 3
  errorStrategy = { task.exitStatus in [125,137,139] ? 'retry' : 'finish' }
  memory = { 80.GB * task.attempt }  // Multiplication directe par task.attempt
  cpu = 5  
  time = '24h' 
}


// ===============================================================================
// CONFIGURATION DE L'EXÉCUTEUR (EXECUTOR)
// ===============================================================================
// Contrôle comment Nextflow interagit avec le gestionnaire de tâches (SLURM)
// ===============================================================================

executor {
  pollInterval = '60 sec'
  submitRateLimit = '60/1min'
  queueSize = 100 
}

// ===============================================================================
// PROFILS D'EXÉCUTION
// ===============================================================================
// Définit des configurations prédéfinies qui peuvent être activées avec -profile
// ===============================================================================

profiles {
  beluga {  // Profil spécifique pour les jobs nécessitant plus de ressources sur Beluga
    max_memory='186G'  // Mémoire maximale par job dans ce profil
    max_cpu= 60  // CPUs maximums par job
    max_time='168h'  // Temps d'exécution maximal (1 semaine)
  }
}


// ===============================================================================
// CHEMINS DES FICHIERS DE RÉFÉRENCE POUR BOWTIE
// ===============================================================================
// Chemins vers les fichiers FASTA des ARN à filtrer (snRNA, snoRNA, rRNA) par espèce
// Ces fichiers sont utilisés dans le filtrage initial avec Bowtie
// false = l'espèce n'est pas configurée/supportée
// ===============================================================================

// Fichiers FASTA pour Bowtie - filtrage des ARN non-codants et ribosomiques
params.path_fasta_HS_B = '/home/ilyass09/scratch/riboseq_pipeline/fasta_files/snRNA_snoRNA_rRNA_HS_ensembl113.fasta'  // Homo sapiens (humain)
params.path_fasta_CE_B = false  // Caenorhabditis elegans (ver)
params.path_fasta_DM_B = false  // Drosophila melanogaster (mouche)
params.path_fasta_SC_B = false  // Saccharomyces cerevisiae (levure)
params.path_fasta_DR_B = false  // Danio rerio (poisson-zèbre)
params.path_fasta_SM_B = false  // Schistosoma mansoni (parasite)


// ===============================================================================
// CHEMINS DES FICHIERS DE RÉFÉRENCE POUR STAR
// ===============================================================================
// Chemins vers les génomes complets (FASTA) et annotations (GTF) par espèce
// Ces fichiers sont utilisés pour l'alignement final avec STAR
// ===============================================================================

// Fichiers de référence pour STAR - alignement sur le génome complet
// Format: génome FASTA + annotation GTF pour chaque espèce
params.path_fasta_HS = '/home/ilyass09/scratch/riboseq_pipeline/fasta_files/complete_genome_HS.fa'  // Génome humain
params.path_fasta_HS_GTF = '/home/ilyass09/scratch/riboseq_pipeline/fasta_files/Homo_sapiens.GRCh38.113.gtf'  // Annotation humaine

// Références pour autres espèces - non configurées dans cette installation
params.path_fasta_CE = false  // Génome C. elegans
params.path_fasta_CE_GTF = false  // Annotation C. elegans

params.path_fasta_DM = false  // Génome D. melanogaster
params.path_fasta_DM_GTF = false  // Annotation D. melanogaster

params.path_fasta_SC = false  // Génome S. cerevisiae
params.path_fasta_SC_GTF = false  // Annotation S. cerevisiae

params.path_fasta_DR = false  // Génome D. rerio
params.path_fasta_DR_GTF = false  // Annotation D. rerio

params.path_fasta_SM = false  // Génome S. mansoni
params.path_fasta_SM_GTF = false  // Annotation S. mansoni





// ===============================================================================
// PARAMÈTRES DU PREMIER STAGE (FIRST STAGE)
// ===============================================================================
// Le premier stage télécharge les données SRA, effectue le contrôle qualité
// et le trimming des lectures.
// ===============================================================================

// Dossier de sortie pour le premier stage
// Contient les données téléchargées, les rapports FastQC et les lectures trimmées
params.outdir_first_stage = '/home/ilyass09/scratch/riboseq_pipeline/output_complet'

// Fichier CSV d'entrée contenant les métadonnées des échantillons à analyser
// Format attendu: 
// Name,Species,Study_accession,Project_link,PMID,Treatment_type,Drug,Sample_accession,Biological_type,Ribo_type,Trim_arg,S_P_type
//params.input_csv = '/home/ilyass09/scratch/riboseq_pipeline/Samples_sheet/Sample_sheet_nic.csv'

//
// Etape Multiqc 
// Parametre pour multiqc 
params.multiqc_config = "/project/def-xroucou/riboseq_pipeline/config_multiqc.yaml"


// ===============================================================================
// PARAMÈTRES DU SECOND STAGE
// ===============================================================================
// Le second stage utilise les fichiers traités du premier stage pour:
// 1. Filtrer les ARN ribosomiques avec Bowtie
// 2. Aligner les lectures restantes sur le génome avec STAR
// ===============================================================================

// Chemin vers le dossier de sortie du premier stage (entrée du second stage)
// Contient les fichiers FASTQ trimés qui seront utilisés pour l'alignement
params.input_output_fastq_second_stage = '/home/ilyass09/scratch/riboseq_pipeline/output_complet_original'

/// params.input_output_fastq_second_stage = '/home/ilyass09/scratch/riboseq_pipeline/output_complet_HS'

// Fichier CSV d'entrée (même que pour le premier stage)
//params.input_csv = '/home/ilyass09/scratch/riboseq_pipeline/Samples_sheet/test.csv'

// Dossier de sortie pour le second stage
// Contiendra les fichiers d'alignement (BAM) et autres résultats
params.outdir_stage_stage = '/home/ilyass09/scratch/riboseq_pipeline/Second_Stage_nic'

// Dossier parent pour les index et autres fichiers communs
// Utilisé pour stocker les index Bowtie et STAR qui peuvent être réutilisés
params.outdir_stage_stage_parent = '/home/ilyass09/scratch/riboseq_pipeline'

// ===============================================================================
// PARAMÈTRES POUR RIBOTIE 
// ===============================================================================
// Paramètres nécessaires pour les nouveaux processus liés à RiboTIE
// ===============================================================================

// Dossier de sortie pour les résultats RiboTIE
//params.outdir_ribotie = '/home/ilyass09/scratch/riboseq_pipeline/ribotie_output_test_complet'

// Chemin vers le répertoire de RiboTIE
params.ribotie_dir = '/home/ilyass09/scratch/riboseq_pipeline/ribotie'

// Nombre maximal d'essais pour les processus RiboTIE
params.max_retries_ribotie = 2


// ===============================================================================
// PARAMÈTRES POUR Third Stage 
// ===============================================================================
// Paramètres nécessaires pour les nouveaux processus liés à ribotie et third stage 
// ===============================================================================

params.star_dir = '/home/ilyass09/scratch/riboseq_pipeline/Second_Stage_copy/HS/STAR'
// params.input_csv = '/home/ilyass09/scratch/riboseq_pipeline/Samples_sheet/test.csv' // ce fichier ne fait rien, ca fait rien parce que ce stage je me suis basé sur les path qui se trouvent dans HS/STAR
params.outdir_ribotie = '/home/ilyass09/scratch/riboseq_pipeline/Ribotie_complet'  
params.ribotie_dir = '/home/ilyass09/scratch/riboseq_pipeline/ribotie'

